---
import BaseLayout from '../layouts/BaseLayout.astro';
import { client, urlFor } from '../lib/sanity/client';
import { allSocialPostsQuery, allTestimonialsQuery } from '../lib/sanity/queries';
import AppreciationFilter from '../components/islands/AppreciationFilter';

// Fetch all data
const [socialPosts, testimonials] = await Promise.all([
  client.fetch(allSocialPostsQuery),
  client.fetch(allTestimonialsQuery),
]);

// Get unique platforms
const platforms = [...new Set(socialPosts.map((p: any) => p.platform))];

const stats = {
  total: socialPosts.length + testimonials.length,
  posts: socialPosts.length,
  testimonials: testimonials.length,
  platforms: platforms.length,
};

// Pre-process image URLs for the React component
const socialPostImages: Record<string, string> = {};
socialPosts.forEach((post: any) => {
  if (post.authorImage) {
    socialPostImages[post._id] = urlFor(post.authorImage).width(48).height(48).url();
  }
});

const testimonialImages: Record<string, string> = {};
testimonials.forEach((testimonial: any) => {
  if (testimonial.image) {
    testimonialImages[testimonial._id] = urlFor(testimonial.image).width(72).height(72).url();
  }
});
---

<BaseLayout
  title="Wall of Appreciation | Faris Aziz"
  description="Kind words, mentions, and testimonials from the community about my talks, work, and contributions."
  pathname="/appreciation"
>
  <!-- Hero Section -->
  <section class="relative min-h-[60vh] flex items-center overflow-hidden">
    <div class="absolute inset-0 grid-pattern opacity-50"></div>
    <div class="absolute inset-0 gradient-mesh"></div>

    <div class="container relative z-10 py-20 md:py-28">
      <div class="max-w-4xl">
        <!-- Terminal intro -->
        <div class="terminal max-w-md mb-8 animate-fade-in">
          <div class="terminal__header">
            <div class="terminal__dots">
              <div class="terminal__dot terminal__dot--red"></div>
              <div class="terminal__dot terminal__dot--yellow"></div>
              <div class="terminal__dot terminal__dot--green"></div>
            </div>
            <span class="terminal__title">appreciation.sh</span>
          </div>
          <div class="terminal__body">
            <span class="terminal__prompt">$</span>
            <span class="terminal__command"> cat community_feedback.md</span>
            <div class="terminal__output">Loading {stats.total} kind words...</div>
          </div>
        </div>

        <h1 class="hero-title mb-6">
          <span class="block text-ink">Wall of</span>
          <span class="block hero-title--gradient">Appreciation</span>
        </h1>

        <p class="text-lead max-w-2xl mb-10">
          Real feedback from conferences, colleagues, and the tech community.
          Every mention motivates me to keep sharing knowledge.
        </p>

        <!-- Quick Stats -->
        <div class="flex flex-wrap gap-8 mb-10">
          <div class="stat-item">
            <span class="stat-item__value text-accent">{stats.posts}</span>
            <span class="stat-item__label">Social Posts</span>
          </div>
          <div class="stat-item">
            <span class="stat-item__value text-violet-500">{stats.testimonials}</span>
            <span class="stat-item__label">Testimonials</span>
          </div>
          <div class="stat-item">
            <span class="stat-item__value text-pink-500">{stats.platforms}</span>
            <span class="stat-item__label">Platforms</span>
          </div>
        </div>

        <!-- Jump Link -->
        <a href="#content" class="btn-primary">
          Explore Feedback
          <svg class="w-4 h-4 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3" />
          </svg>
        </a>
      </div>
    </div>
  </section>

  <!-- Tabbed Feedback Section -->
  <section id="content" class="section py-16 md:py-24">
    <div class="container">
      <!-- Section Header -->
      <div class="text-center mb-10">
        <p class="text-accent font-mono text-sm tracking-wider uppercase mb-3">Community Feedback</p>
        <h2 class="text-3xl md:text-4xl font-display font-bold text-ink">
          What People <span class="text-gradient">Say</span>
        </h2>
      </div>

      <!-- React Island for Interactive Tabs & Filters -->
      <AppreciationFilter
        client:load
        socialPosts={socialPosts}
        testimonials={testimonials}
        socialPostImages={socialPostImages}
        testimonialImages={testimonialImages}
      />
    </div>
  </section>

  <!-- CTA Section -->
  <section class="relative overflow-hidden">
    <div class="absolute inset-0 bg-gradient-to-br from-accent via-violet-600 to-pink-600"></div>
    <div class="absolute inset-0 grid-pattern opacity-10"></div>

    <div class="container relative z-10 py-20 md:py-28">
      <div class="max-w-3xl mx-auto text-center">
        <h2 class="text-3xl md:text-4xl font-display font-bold text-white mb-4">
          Want to share your experience?
        </h2>
        <p class="text-white/80 text-lg mb-8">
          If you've attended one of my talks or worked with me, I'd love to hear your feedback.
        </p>
        <div class="flex flex-wrap gap-4 justify-center">
          <a
            href="https://twitter.com/FarisAziz12"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 px-6 py-3 bg-white text-gray-900 font-semibold rounded-xl hover:bg-white/90 transition-all"
          >
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
            </svg>
            Tag me on X
          </a>
          <a
            href="https://linkedin.com/in/farisaziz12"
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center gap-2 px-6 py-3 bg-white/10 text-white font-semibold rounded-xl border border-white/30 hover:bg-white/20 transition-all"
          >
            <svg class="w-5 h-5" viewBox="0 0 24 24" fill="currentColor">
              <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
            </svg>
            Connect on LinkedIn
          </a>
        </div>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  /* Hero Stats */
  .stat-item {
    display: flex;
    flex-direction: column;
  }

  .stat-item__value {
    font-size: 2.5rem;
    font-weight: 700;
    font-family: var(--font-display);
    line-height: 1;
  }

  .stat-item__label {
    font-size: 0.75rem;
    color: var(--ink-muted);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-top: 0.25rem;
  }
</style>
