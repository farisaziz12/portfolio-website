---
import { urlFor } from '../../lib/sanity/client';

interface SocialPost {
  _id: string;
  url: string;
  platform: 'linkedin' | 'twitter';
  author: string;
  authorHandle?: string;
  authorImage?: any;
  authorRole?: string;
  postImage?: any;
  content: string;
  tweetId?: string;
  postDate?: string;
  relatedTalk?: { title: string; slug: string };
  relatedEvent?: { title: string; slug: string; conference: string };
}

interface Testimonial {
  _id: string;
  quote: string;
  author: string;
  role?: string;
  company?: string;
  image?: any;
}

interface Props {
  posts: SocialPost[];
  testimonials?: Testimonial[];
}

const { posts, testimonials = [] } = Astro.props;

// Interleave posts and testimonials for variety
const allItems: Array<{ type: 'post' | 'testimonial'; data: SocialPost | Testimonial }> = [];
const maxItems = Math.max(posts.length, testimonials.length);

for (let i = 0; i < maxItems; i++) {
  if (posts[i]) allItems.push({ type: 'post', data: posts[i] });
  if (testimonials[i]) allItems.push({ type: 'testimonial', data: testimonials[i] });
}
---

<section class="social-wall py-20 md:py-28 overflow-hidden relative">
  {/* Background effects */}
  <div class="absolute inset-0 bg-gradient-to-b from-surface via-surface-overlay/50 to-surface pointer-events-none"></div>
  <div class="absolute inset-0 dot-pattern opacity-30 pointer-events-none"></div>

  <div class="container relative z-10">
    {/* Header */}
    <div class="text-center mb-16">
      <div class="inline-flex items-center gap-2 px-4 py-2 bg-accent/10 border border-accent/20 rounded-full text-accent text-sm font-medium mb-6">
        <span class="relative flex h-2 w-2">
          <span class="relative inline-flex rounded-full h-2 w-2 bg-accent"></span>
        </span>
        From the community
      </div>
      <h2 class="heading-2 mb-4">
        What People <span class="text-gradient">Say</span>
      </h2>
      <p class="text-ink-muted text-lg max-w-xl mx-auto mb-6">
        Real reactions from conferences, meetups, and colleagues
      </p>
      <a href="/appreciation" class="view-all-link">
        View all mentions
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M5 12h14M12 5l7 7-7 7" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
      </a>
    </div>

    {/* Bento Grid Layout */}
    <div class="social-bento max-w-7xl mx-auto">
      {allItems.slice(0, 9).map((item, index) => {
        if (item.type === 'post') {
          const post = item.data as SocialPost;
          return (
            <div
              class="social-card group"
              style={`--index: ${index}`}
              data-post-url={post.url}
            >
              {/* Animated border gradient */}
              <div class="social-card-border"></div>

              {/* Content */}
              <div class="social-card-inner">
                {/* Post image/screenshot */}
                {post.postImage ? (
                  <div class="social-image-wrapper">
                    <img
                      src={urlFor(post.postImage).width(800).quality(90).url()}
                      alt={`Post by ${post.author}`}
                      class="social-image"
                      loading="lazy"
                    />
                    <div class="social-image-overlay">
                      <span class="social-view-cta">
                        View on {post.platform === 'twitter' ? 'X' : 'LinkedIn'}
                        <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" />
                        </svg>
                      </span>
                    </div>
                    {/* Platform badge for image posts */}
                    <div class={`social-platform ${post.platform}`}>
                      {post.platform === 'twitter' ? (
                        <svg viewBox="0 0 24 24" fill="currentColor">
                          <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                        </svg>
                      ) : (
                        <svg viewBox="0 0 24 24" fill="currentColor">
                          <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                        </svg>
                      )}
                    </div>
                  </div>
                ) : post.platform === 'twitter' ? (
                  /* Twitter/X Style Post */
                  <div class="tweet-card" data-content-length={post.content.length}>
                    {/* Tweet Header */}
                    <div class="tweet-header">
                      {post.authorImage ? (
                        <img
                          src={urlFor(post.authorImage).width(48).height(48).url()}
                          alt={post.author}
                          class="tweet-avatar"
                        />
                      ) : (
                        <div class="tweet-avatar tweet-avatar--placeholder">
                          <span>{post.author?.charAt(0)}</span>
                        </div>
                      )}
                      <div class="tweet-author">
                        <div class="tweet-author-name">
                          <span>{post.author}</span>
                          <svg class="tweet-verified" viewBox="0 0 22 22" fill="currentColor">
                            <path d="M20.396 11c-.018-.646-.215-1.275-.57-1.816-.354-.54-.852-.972-1.438-1.246.223-.607.27-1.264.14-1.897-.131-.634-.437-1.218-.882-1.687-.47-.445-1.053-.75-1.687-.882-.633-.13-1.29-.083-1.897.14-.273-.587-.704-1.086-1.245-1.44S11.647 1.62 11 1.604c-.646.017-1.273.213-1.813.568s-.969.854-1.24 1.44c-.608-.223-1.267-.272-1.902-.14-.635.13-1.22.436-1.69.882-.445.47-.749 1.055-.878 1.688-.13.633-.08 1.29.144 1.896-.587.274-1.087.705-1.443 1.245-.356.54-.555 1.17-.574 1.817.02.647.218 1.276.574 1.817.356.54.856.972 1.443 1.245-.224.606-.274 1.263-.144 1.896.13.634.433 1.218.877 1.688.47.443 1.054.747 1.687.878.633.132 1.29.084 1.897-.136.274.586.705 1.084 1.246 1.439.54.354 1.17.551 1.816.569.647-.016 1.276-.213 1.817-.567s.972-.854 1.245-1.44c.604.239 1.266.296 1.903.164.636-.132 1.22-.447 1.68-.907.46-.46.776-1.044.908-1.681s.075-1.299-.165-1.903c.586-.274 1.084-.705 1.439-1.246.354-.54.551-1.17.569-1.816zM9.662 14.85l-3.429-3.428 1.293-1.302 2.072 2.072 4.4-4.794 1.347 1.246z"/>
                          </svg>
                        </div>
                        <span class="tweet-handle">@{post.authorHandle || post.author?.toLowerCase().replace(/\s/g, '')}</span>
                      </div>
                      <svg class="tweet-logo" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
                      </svg>
                    </div>

                    {/* Tweet Content */}
                    <p class="tweet-content">
                      {post.content}
                    </p>

                    {/* Actions: Expand (if truncated) + Read on platform */}
                    <div class="post-actions">
                      {post.content.length > 150 && (
                        <button class="post-action post-action--expand" data-expand-btn>
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                          <span class="expand-text">Show more</span>
                        </button>
                      )}
                      <a href={post.url} target="_blank" rel="noopener noreferrer" class="post-action post-action--link post-action--twitter">
                        Read on X
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M7 17L17 7M17 7H7M17 7V17" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </a>
                    </div>

                    {/* Tweet Footer */}
                    <div class="tweet-footer">
                      <span class="tweet-time">
                        {post.postDate ? new Date(post.postDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' }) : ''}
                      </span>
                    </div>
                  </div>
                ) : (
                  /* LinkedIn Style Post */
                  <div class="linkedin-card">
                    {/* LinkedIn Header */}
                    <div class="linkedin-header">
                      {post.authorImage ? (
                        <img
                          src={urlFor(post.authorImage).width(48).height(48).url()}
                          alt={post.author}
                          class="linkedin-avatar"
                        />
                      ) : (
                        <div class="linkedin-avatar linkedin-avatar--placeholder">
                          <span>{post.author?.charAt(0)}</span>
                        </div>
                      )}
                      <div class="linkedin-author">
                        <span class="linkedin-name">{post.author}</span>
                        {post.authorRole && <span class="linkedin-headline">{post.authorRole}</span>}
                        <div class="linkedin-meta">
                          <span>{post.postDate ? new Date(post.postDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : ''}</span>
                          <span>â€¢</span>
                          <svg viewBox="0 0 16 16" fill="currentColor"><path d="M8 1a7 7 0 1 0 7 7 7 7 0 0 0-7-7zM3 8a5 5 0 0 1 1.88-3.9L8 7.22V3a5 5 0 1 1-5 5z"/></svg>
                        </div>
                      </div>
                      <svg class="linkedin-logo" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
                      </svg>
                    </div>

                    {/* LinkedIn Content */}
                    <p class="linkedin-content">
                      {post.content}
                    </p>

                    {/* Actions: Expand (if truncated) + Read on platform */}
                    <div class="post-actions">
                      {post.content.length > 150 && (
                        <button class="post-action post-action--expand" data-expand-btn>
                          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M19 9l-7 7-7-7" stroke-linecap="round" stroke-linejoin="round"/>
                          </svg>
                          <span class="expand-text">Show more</span>
                        </button>
                      )}
                      <a href={post.url} target="_blank" rel="noopener noreferrer" class="post-action post-action--link post-action--linkedin">
                        Read on LinkedIn
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                          <path d="M7 17L17 7M17 7H7M17 7V17" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                      </a>
                    </div>
                  </div>
                )}
              </div>

              {/* Glow effect */}
              <div class="social-glow"></div>
            </div>
          );
        } else {
          const testimonial = item.data as Testimonial;
          return (
            <div
              class="testimonial-card"
              style={`--index: ${index}`}
            >
              <div class="testimonial-inner">
                {/* Quote icon */}
                <div class="testimonial-quote-icon">
                  <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/>
                  </svg>
                </div>

                {/* Quote */}
                <p class="text-ink text-sm leading-relaxed mb-4">
                  "{testimonial.quote}"
                </p>

                {/* Author */}
                <div class="flex items-center gap-3 mt-auto pt-4 border-t border-edge">
                  {testimonial.image ? (
                    <img
                      src={urlFor(testimonial.image).width(48).height(48).url()}
                      alt={testimonial.author}
                      class="w-10 h-10 rounded-full object-cover"
                    />
                  ) : (
                    <div class="w-10 h-10 rounded-full bg-gradient-to-br from-accent to-violet-500 flex items-center justify-center">
                      <span class="font-bold text-white text-sm">{testimonial.author?.charAt(0)}</span>
                    </div>
                  )}
                  <div class="min-w-0">
                    <p class="font-semibold text-ink text-sm">{testimonial.author}</p>
                    {(testimonial.role || testimonial.company) && (
                      <p class="text-xs text-ink-muted truncate">
                        {testimonial.role}{testimonial.company && ` at ${testimonial.company}`}
                      </p>
                    )}
                  </div>
                </div>
              </div>
            </div>
          );
        }
      })}
    </div>

    {/* Floating particles */}
    <div class="social-particles" aria-hidden="true">
      <div class="particle particle-1"></div>
      <div class="particle particle-2"></div>
      <div class="particle particle-3"></div>
      <div class="particle particle-4"></div>
      <div class="particle particle-5"></div>
    </div>
  </div>
</section>

<style>
  .social-wall {
    --accent-rgb: 99, 102, 241;
  }

  .dot-pattern {
    background-image: radial-gradient(circle, var(--edge) 1px, transparent 1px);
    background-size: 24px 24px;
  }

  .view-all-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--accent);
    font-weight: 500;
    text-decoration: none;
    transition: gap 0.2s ease;
  }

  .view-all-link:hover {
    gap: 0.75rem;
  }

  .view-all-link svg {
    width: 1.25rem;
    height: 1.25rem;
  }

  /* Bento Grid */
  .social-bento {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1rem;
    align-items: start;
  }

  @media (max-width: 1024px) {
    .social-bento {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 640px) {
    .social-bento {
      grid-template-columns: 1fr;
    }
  }

  /* Social Card */
  .social-card {
    position: relative;
    display: block;
    border-radius: 1.25rem;
    overflow: hidden;
    animation: card-enter 0.6s ease-out both;
    animation-delay: calc(var(--index) * 0.1s);
  }

  @keyframes card-enter {
    from {
      opacity: 0;
      transform: translateY(20px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .social-card-border {
    position: absolute;
    inset: 0;
    border-radius: 1.25rem;
    padding: 1px;
    background: var(--edge);
    -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    -webkit-mask-composite: xor;
    mask-composite: exclude;
    transition: background 0.4s ease;
  }

  .social-card:hover:not(.is-expanded) .social-card-border {
    background: linear-gradient(135deg, var(--accent), var(--violet-500, #8b5cf6), var(--accent));
  }

  .social-card-inner {
    position: relative;
    background: var(--surface-raised);
    border-radius: 1.25rem;
    overflow: hidden;
    transition: transform 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  .social-card:hover:not(.is-expanded) .social-card-inner {
    transform: scale(0.98);
  }

  /* Platform Badge */
  .social-platform {
    position: absolute;
    top: 1rem;
    right: 1rem;
    width: 2.25rem;
    height: 2.25rem;
    border-radius: 0.625rem;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 10;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  }

  .social-platform svg {
    width: 1.125rem;
    height: 1.125rem;
  }

  .social-platform.twitter {
    background: black;
    color: white;
  }

  .social-platform.linkedin {
    background: #0A66C2;
    color: white;
  }

  .social-card:hover:not(.is-expanded) .social-platform {
    transform: rotate(12deg) scale(1.1);
  }

  /* Post Image */
  .social-image-wrapper {
    position: relative;
    width: 100%;
    height: 100%;
    min-height: 200px;
    overflow: hidden;
  }

  .social-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.6s ease;
  }

  .social-card:hover .social-image {
    transform: scale(1.05);
  }

  .social-image-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.8), transparent 60%);
    display: flex;
    align-items: flex-end;
    justify-content: center;
    padding: 1.5rem;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .social-card:hover .social-image-overlay {
    opacity: 1;
  }

  .social-view-cta {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.625rem 1rem;
    background: white;
    color: black;
    font-size: 0.875rem;
    font-weight: 600;
    border-radius: 9999px;
    transform: translateY(10px);
    transition: transform 0.3s ease;
  }

  .social-card:hover .social-view-cta {
    transform: translateY(0);
  }

  /* ==================== */
  /* Twitter/X Card Style */
  /* ==================== */
  .tweet-card {
    padding: 0.875rem;
    display: flex;
    flex-direction: column;
    background: #000;
    border-radius: 1.25rem;
  }

  .tweet-header {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .tweet-avatar {
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    object-fit: cover;
    flex-shrink: 0;
  }

  .tweet-avatar--placeholder {
    background: #333;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 0.75rem;
  }

  .tweet-author {
    flex: 1;
    min-width: 0;
    display: flex;
    align-items: center;
    gap: 0.375rem;
    flex-wrap: wrap;
  }

  .tweet-author-name {
    display: flex;
    align-items: center;
    gap: 0.125rem;
    font-weight: 700;
    font-size: 0.8125rem;
    color: white;
  }

  .tweet-verified {
    width: 0.875rem;
    height: 0.875rem;
    color: #1d9bf0;
    flex-shrink: 0;
  }

  .tweet-handle {
    font-size: 0.8125rem;
    color: rgb(113 118 123);
  }

  .tweet-logo {
    width: 1.125rem;
    height: 1.125rem;
    color: white;
    flex-shrink: 0;
  }

  .tweet-content {
    color: rgb(231 233 234);
    font-size: 0.875rem;
    line-height: 1.45;
    white-space: pre-line;
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .tweet-content.expanded {
    -webkit-line-clamp: unset;
    display: block;
  }

  .tweet-footer {
    display: flex;
    align-items: center;
    gap: 0.375rem;
    margin-top: 0.5rem;
    padding-top: 0.5rem;
    border-top: 1px solid rgb(47 51 54);
  }

  .tweet-time {
    font-size: 0.75rem;
    color: rgb(113 118 123);
  }

  /* Post Actions (Expand + Link) */
  .post-actions {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 0.5rem;
    margin-top: auto;
    padding-top: 0.5rem;
    opacity: 0.7;
    transition: opacity 0.2s;
    flex-shrink: 0;
  }

  .social-card:hover .post-actions {
    opacity: 1;
  }

  .post-action {
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.6875rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }

  .post-action svg {
    width: 0.75rem;
    height: 0.75rem;
    transition: transform 0.2s;
  }

  .post-action--expand {
    background: none;
    border: none;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    margin-left: -0.5rem;
  }

  .tweet-card .post-action--expand {
    color: rgb(231 233 234);
  }

  .tweet-card .post-action--expand:hover {
    background: rgba(255, 255, 255, 0.1);
    color: #1d9bf0;
  }

  .linkedin-card .post-action--expand {
    color: #666;
  }

  .linkedin-card .post-action--expand:hover {
    background: rgba(0, 0, 0, 0.05);
    color: #0a66c2;
  }

  .post-action--expand.expanded svg {
    transform: rotate(180deg);
  }

  .post-action--expand.expanded .expand-text::after {
    content: 'Show less';
  }

  .post-action--expand.expanded .expand-text {
    font-size: 0;
  }

  .post-action--expand.expanded .expand-text::after {
    font-size: 0.6875rem;
  }

  .post-action--link {
    margin-left: auto;
    text-decoration: none;
  }

  .post-action--twitter {
    color: #1d9bf0;
  }

  .post-action--linkedin {
    color: #0a66c2;
  }

  .post-action--link:hover svg {
    transform: translate(2px, -2px);
  }

  /* ==================== */
  /* LinkedIn Card Style */
  /* ==================== */
  .linkedin-card {
    padding: 0.875rem;
    display: flex;
    flex-direction: column;
    background: #fff;
    border-radius: 1.25rem;
  }

  .linkedin-header {
    display: flex;
    align-items: flex-start;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
  }

  .linkedin-avatar {
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 50%;
    object-fit: cover;
    flex-shrink: 0;
  }

  .linkedin-avatar--placeholder {
    background: #0a66c2;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: 600;
    font-size: 0.875rem;
  }

  .linkedin-author {
    flex: 1;
    min-width: 0;
  }

  .linkedin-name {
    display: block;
    font-weight: 600;
    font-size: 0.8125rem;
    color: #000;
    line-height: 1.3;
  }

  .linkedin-headline {
    display: block;
    font-size: 0.6875rem;
    color: #666;
    line-height: 1.3;
  }

  .linkedin-meta {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.6875rem;
    color: #666;
    margin-top: 0.125rem;
  }

  .linkedin-meta svg {
    width: 0.75rem;
    height: 0.75rem;
  }

  .linkedin-logo {
    width: 1.25rem;
    height: 1.25rem;
    color: #0a66c2;
    flex-shrink: 0;
  }

  .linkedin-content {
    color: #000;
    font-size: 0.8125rem;
    line-height: 1.45;
    white-space: pre-line;
    display: -webkit-box;
    -webkit-line-clamp: 4;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .linkedin-content.expanded {
    -webkit-line-clamp: unset;
    display: block;
  }

  /* Glow effect */
  .social-glow {
    position: absolute;
    inset: 0;
    background: radial-gradient(
      circle at var(--mouse-x, 50%) var(--mouse-y, 50%),
      rgba(var(--accent-rgb), 0.15),
      transparent 50%
    );
    opacity: 0;
    transition: opacity 0.3s ease;
    pointer-events: none;
    border-radius: 1.25rem;
  }

  .social-card:hover:not(.is-expanded) .social-glow {
    opacity: 1;
  }

  /* Testimonial Card */
  .testimonial-card {
    position: relative;
    border-radius: 1.25rem;
    background: linear-gradient(135deg, var(--surface-raised), var(--surface-overlay));
    border: 1px solid var(--edge);
    animation: card-enter 0.6s ease-out both;
    animation-delay: calc(var(--index) * 0.1s);
    transition: all 0.4s ease;
  }

  .testimonial-card:hover {
    border-color: var(--accent);
    transform: translateY(-4px);
    box-shadow: 0 20px 40px -15px rgba(var(--accent-rgb), 0.2);
  }

  .testimonial-inner {
    padding: 1.5rem;
    display: flex;
    flex-direction: column;
  }

  .testimonial-quote-icon {
    width: 2rem;
    height: 2rem;
    color: var(--accent);
    opacity: 0.3;
    margin-bottom: 0.75rem;
  }

  .testimonial-quote-icon svg {
    width: 100%;
    height: 100%;
  }

  /* Floating Particles */
  .social-particles {
    position: absolute;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
  }

  .particle {
    position: absolute;
    width: 6px;
    height: 6px;
    border-radius: 50%;
    background: var(--accent);
    opacity: 0.4;
  }

  .particle-1 {
    top: 20%;
    left: 10%;
    animation: float-particle 8s ease-in-out infinite;
  }

  .particle-2 {
    top: 60%;
    left: 85%;
    animation: float-particle 10s ease-in-out infinite reverse;
    background: var(--violet-500, #8b5cf6);
  }

  .particle-3 {
    top: 80%;
    left: 30%;
    animation: float-particle 7s ease-in-out infinite 1s;
    background: var(--pink-500, #ec4899);
  }

  .particle-4 {
    top: 30%;
    left: 70%;
    animation: float-particle 9s ease-in-out infinite 0.5s;
  }

  .particle-5 {
    top: 50%;
    left: 5%;
    animation: float-particle 11s ease-in-out infinite 2s;
    background: var(--emerald-500, #10b981);
  }

  @keyframes float-particle {
    0%, 100% {
      transform: translate(0, 0) scale(1);
      opacity: 0.4;
    }
    25% {
      transform: translate(30px, -20px) scale(1.2);
      opacity: 0.6;
    }
    50% {
      transform: translate(-20px, -40px) scale(0.8);
      opacity: 0.3;
    }
    75% {
      transform: translate(10px, -10px) scale(1.1);
      opacity: 0.5;
    }
  }

  /* Reduce motion */
  @media (prefers-reduced-motion: reduce) {
    .social-card,
    .testimonial-card {
      animation: none;
    }
    .particle {
      animation: none;
    }
  }
</style>

<script>
  function initSocialWall() {
    // Mouse tracking for glow effect
    const cards = document.querySelectorAll('.social-card');

    cards.forEach(card => {
      card.addEventListener('mousemove', (e) => {
        const event = e as MouseEvent;
        const rect = (card as HTMLElement).getBoundingClientRect();
        const x = ((event.clientX - rect.left) / rect.width) * 100;
        const y = ((event.clientY - rect.top) / rect.height) * 100;
        (card as HTMLElement).style.setProperty('--mouse-x', `${x}%`);
        (card as HTMLElement).style.setProperty('--mouse-y', `${y}%`);
      });
    });

    // Tilt effect on hover (disabled when expanded)
    cards.forEach(card => {
      card.addEventListener('mousemove', (e) => {
        // Skip tilt effect if content is expanded
        const expandedContent = card.querySelector('.tweet-content.expanded, .linkedin-content.expanded');
        if (expandedContent) return;

        const event = e as MouseEvent;
        const rect = (card as HTMLElement).getBoundingClientRect();
        const x = event.clientX - rect.left;
        const y = event.clientY - rect.top;
        const centerX = rect.width / 2;
        const centerY = rect.height / 2;
        const rotateX = (y - centerY) / 20;
        const rotateY = (centerX - x) / 20;

        const inner = card.querySelector('.social-card-inner') as HTMLElement;
        if (inner) {
          inner.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(0.98)`;
        }
      });

      card.addEventListener('mouseleave', () => {
        const inner = card.querySelector('.social-card-inner') as HTMLElement;
        if (inner) {
          inner.style.transform = '';
        }
      });
    });

    // Expand button functionality - only one expanded at a time
    const expandButtons = document.querySelectorAll('[data-expand-btn]');
    expandButtons.forEach(btn => {
      btn.addEventListener('click', (e) => {
        e.preventDefault();
        e.stopPropagation();

        const card = btn.closest('.social-card');
        if (!card) return;

        const content = card.querySelector('.tweet-content, .linkedin-content') as HTMLElement;
        if (!content) return;

        const wasExpanded = content.classList.contains('expanded');

        // Collapse all other expanded posts first
        document.querySelectorAll('.social-card.is-expanded').forEach(otherCard => {
          if (otherCard !== card) {
            const otherContent = otherCard.querySelector('.tweet-content, .linkedin-content');
            const otherBtn = otherCard.querySelector('[data-expand-btn]');
            const otherTextSpan = otherBtn?.querySelector('.expand-text') as HTMLElement;

            otherContent?.classList.remove('expanded');
            otherBtn?.classList.remove('expanded');
            otherCard.classList.remove('is-expanded');
            if (otherTextSpan) {
              otherTextSpan.textContent = 'Show more';
            }
          }
        });

        // Toggle current post
        const isExpanded = !wasExpanded;
        content.classList.toggle('expanded', isExpanded);
        btn.classList.toggle('expanded', isExpanded);
        card.classList.toggle('is-expanded', isExpanded);

        // Reset any lingering transform when expanding
        if (isExpanded) {
          const inner = card.querySelector('.social-card-inner') as HTMLElement;
          if (inner) {
            inner.style.transform = '';
          }
        }

        // Update button text
        const textSpan = btn.querySelector('.expand-text') as HTMLElement;
        if (textSpan) {
          textSpan.textContent = isExpanded ? 'Show less' : 'Show more';
        }
      });
    });
  }

  // Initialize
  document.addEventListener('DOMContentLoaded', initSocialWall);
  document.addEventListener('astro:after-swap', initSocialWall);
</script>
