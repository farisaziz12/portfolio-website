---
import type { PortableTextBlock, ArbitraryTypedObject } from '@portabletext/types';
import { extractHeadings } from '../../lib/portable-text-utils';

interface Props {
  body: (PortableTextBlock | ArbitraryTypedObject)[];
}

const { body } = Astro.props;
const headings = extractHeadings(body);
const hasHeadings = headings.length > 0;
---

{hasHeadings && (
  <nav class="mb-12 p-6 bg-surface-raised rounded-xl border border-edge" aria-label="Table of contents">
    <div class="flex items-center gap-3 mb-5 pb-4 border-b border-edge">
      <div class="w-8 h-8 rounded-lg bg-accent/10 flex items-center justify-center">
        <svg class="w-4 h-4 text-accent" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16" />
        </svg>
      </div>
      <h2 class="text-base font-semibold text-ink">In this article</h2>
    </div>
    <ul class="space-y-1">
      {headings.map((heading, index) => {
        const h2Index = headings.slice(0, index + 1).filter(h => h.level === 2).length;
        return (
          <li
            class:list={[
              'relative',
              heading.level === 2 && 'mt-3 first:mt-0',
              heading.level === 3 && 'ml-4 border-l-2 border-edge',
              heading.level === 4 && 'ml-8 border-l-2 border-edge',
            ]}
          >
            <a
              href={`#${heading.id}`}
              class:list={[
                'block py-1.5 px-3 rounded-md hover:bg-accent/5 hover:text-accent transition-all cursor-pointer',
                heading.level === 2 && 'text-ink font-medium',
                heading.level === 3 && 'text-ink-muted text-sm',
                heading.level === 4 && 'text-ink-faint text-sm',
              ]}
            >
              {heading.level === 2 && (
                <span class="inline-flex items-center justify-center w-5 h-5 mr-2 text-xs font-semibold bg-accent/10 text-accent rounded">
                  {h2Index}
                </span>
              )}
              {heading.text}
            </a>
          </li>
        );
      })}
    </ul>
  </nav>
)}

